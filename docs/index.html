<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>PCAP Viewer</title>
  <script src="https://cdn.jsdelivr.net/npm/pcapjs@latest/dist/pcap.min.js"></script>
  <style>
    body { margin: 0; font-family: sans-serif; background: #f9f9f9; color: #333; }
    #viewer { padding: 1em; }
    a { display: block; margin: 0.5em 0; color: blue; text-decoration: none; }
  </style>
</head>
<body>
  <h1>Interactive PCAP Viewer</h1>
  <div id="viewer">Lade PCAP…</div>

  <h2>PCAP-Dateien:</h2>
  <ul>
    <li><a href="?file=pcaps/Alarame2.pcap">Alarame2.pcap</a></li>
    <li><a href="?file=pcaps/geschichte.pcap">geschichte.pcap</a></li>
    <li><a href="?file=pcaps/music.pcap">music.pcap</a></li>
    <li><a href="?file=pcaps/recherche.pcap">recherche.pcap</a></li>
    <li><a href="?file=pcaps/Nachrichten2.pcap">Nachrichten2.pcap</a></li>
  </ul>

  <script>
    const rawBase = 'https://raw.githubusercontent.com/tatiana917/meine-pcaps/main/';
    const params = new URLSearchParams(location.search);
    const filePath = params.get('file');

    if (!filePath) {
      document.getElementById('viewer').textContent = 'Bitte eine PCAP-Datei auswählen.';
    } else {
      const pcapUrl = rawBase + filePath;
      document.getElementById('viewer').textContent = 'Lade ' + filePath + '…';

      fetch(pcapUrl)
        .then(r => {
          if (!r.ok) throw new Error(r.status + ' ' + r.statusText);
          return r.arrayBuffer();
        })
        .then(buf => {
          const data = pcap.parse(buf);
          document.getElementById('viewer').textContent =
            `✅ ${filePath} geladen: ${data.packets.length} Pakete`;
          console.log(data);
        })
        .catch(err => {
          document.getElementById('viewer').textContent =
            '❌ Fehler beim Laden: ' + err;
        });
    }
  </script>
</body>
</html>
